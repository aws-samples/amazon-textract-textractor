<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Textractor for Large Language Models (LLM) &mdash; amazon-textract-textractor 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interfacing with trp2" href="interfacing_with_trp2.html" />
    <link rel="prev" title="Using Layout Analysis for Text Linearization" href="layout_analysis_for_text_linearization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> amazon-textract-textractor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_in_lambda.html">Using Textractor in AWS Lambda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simple_ocr.html">Using Textract OCR</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsing_an_existing_response.html">Parsing an existing response</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction_to_searching.html">Introduction to searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualizing_results.html">Visualizing Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="finding_words_within_a_document.html">Word Occurence within Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporting_form_data.html">Exporting Form Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="table_data_to_various_formats.html">Table data extraction to Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_analyze_expense.html">Using AnalyzeExpense</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_analyze_id.html">Using AnalyzeID</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_queries.html">Using Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_analysis.html">Using Layout Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_analysis_for_text_linearization.html">Using Layout Analysis for Text Linearization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Textractor for Large Language Models (LLM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calling-Textract">Calling Textract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="interfacing_with_trp2.html">Interfacing with trp2</a></li>
<li class="toctree-l2"><a class="reference internal" href="signature_detection.html">Signature Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="going_further.html">Going further</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">CLI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../textractor.html">Textract Caller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../textractor.parsers.html">Entity Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../textractor.entities.html">Document Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../textractor.visualizers.html">Entity Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../textractor.data.constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../textractor.data.text_linearization_config.html">TextLinearizationConfig</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">amazon-textract-textractor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../examples.html">Examples</a> &raquo;</li>
      <li>Textractor for Large Language Models (LLM)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/textractor_for_large_language_models.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Textractor-for-Large-Language-Models-(LLM)">
<h1>Textractor for Large Language Models (LLM)<a class="headerlink" href="#Textractor-for-Large-Language-Models-(LLM)" title="Permalink to this heading"></a></h1>
<p>This example explores how using the various Textract APIs with Textractor to enrich the text given to a large language model, allowing us to process documents where some of data is not in text.</p>
<section id="Installation">
<h2>Installation<a class="headerlink" href="#Installation" title="Permalink to this heading"></a></h2>
<p>To begin, install the <code class="docutils literal notranslate"><span class="pre">amazon-textract-textractor</span></code> package using pip.</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">amazon-textract-textractor</span></code></p>
<p>There are various sets of dependencies available to tailor your installation to your use case. The base package will have sensible default, but you may want to install the PDF extra dependencies if your workflow uses PDFs with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">amazon-textract-textractor[pdf]</span></code>. You can read more on extra dependencies <a class="reference external" href="https://aws-samples.github.io/amazon-textract-textractor/installation.html">in the documentation</a></p>
</section>
<section id="Calling-Textract">
<h2>Calling Textract<a class="headerlink" href="#Calling-Textract" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">textractor</span> <span class="kn">import</span> <span class="n">Textractor</span>
<span class="kn">from</span> <span class="nn">textractor.visualizers.entitylist</span> <span class="kn">import</span> <span class="n">EntityList</span>
<span class="kn">from</span> <span class="nn">textractor.data.constants</span> <span class="kn">import</span> <span class="n">TextractFeatures</span>

<span class="k">def</span> <span class="nf">get_response_from_claude</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
        <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Human: Given the following document:</span>
<span class="s2">        </span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Answer the following:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">prompt_data</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Assistant:&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_tokens_to_sample&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">modelId</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;anthropic.claude-instant-v1&#39;</span> <span class="c1"># change this to use a different version from the model provider</span>
    <span class="n">accept</span> <span class="o">=</span> <span class="s1">&#39;*/*&#39;</span>
    <span class="n">contentType</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">invoke_model</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">modelId</span><span class="o">=</span><span class="n">modelId</span><span class="p">,</span> <span class="n">accept</span><span class="o">=</span><span class="n">accept</span><span class="p">,</span> <span class="n">contentType</span><span class="o">=</span><span class="n">contentType</span><span class="p">)</span>
    <span class="n">response_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">response_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;completion&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">answer</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AWS_DEFAULT_REGION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;us-west-2&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;BEDROCK_ENDPOINT_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://bedrock-runtime.us-west-2.amazonaws.com&quot;</span>

<span class="n">bedrock</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;bedrock-runtime&#39;</span><span class="p">,</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-west-2&#39;</span><span class="p">,</span><span class="n">endpoint_url</span><span class="o">=</span><span class="s1">&#39;https://bedrock-runtime.us-west-2.amazonaws.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;../../../tests/fixtures/form_1005.png&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
<span class="n">image</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_textractor_for_large_language_models_2_0.png" src="../_images/notebooks_textractor_for_large_language_models_2_0.png" />
</div>
</div>
<p>Our example is a verification of employment form for a mortgage. This is a complex forms with over 30 fields, selection elements (checkboxes) and signatures that we want to process using Amazon Bedrock and Claude. However, LLMs only take text as input therefore we have to first convert the visual clues into textual clues. This can be done with Textractor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">textractor</span> <span class="kn">import</span> <span class="n">Textractor</span>
<span class="kn">from</span> <span class="nn">textractor.data.text_linearization_config</span> <span class="kn">import</span> <span class="n">TextLinearizationConfig</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="n">Textractor</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s2">&quot;us-west-2&quot;</span><span class="p">)</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span>
    <span class="n">file_source</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">TextractFeatures</span><span class="o">.</span><span class="n">LAYOUT</span><span class="p">],</span>
    <span class="n">save_image</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Request for Verification of Employment
Privacy Act Notice: This information is to be used by the agency collecting it or its assignees in determining whether you qualify as a prospective mortgagor under its program. It will not be disclosed outside the agency except as required and permitted by law. You do not have to provide this information, but if you do not your application for approval as a prospec- tive mortgagor or borrower may be delayed or rejected. The information requested in this form is authorized by Title 38, USC, Chapter 37 (if VA); by 12 USC, Section 1701 et. seq. (if HUD/FHA); by 42 USC, Section 1452b (if HUD/CPD); and Title 42 USC, 1471 et. seq., or 7 USC, 1921 et. seq. (if USDA/FmHA).
Instructions: Lender - Complete items 1 through 7. Have applicant complete item 8. Forward directly to employer named in item 1. Employer - Please complete either Part II or Part III as applicable. Complete Part IV and return directly to lender named in item 2. The form is to be transmitted directly to the lender and is not to be transmitted through the applicant or any other party.
Part I - Request 1. To (Name and address of employer)

2. From (Name and address of lender)

Alejandro Rosalez

Carlos Salazar 123 Any Street, Any Town, USA

100 Main Street, Anytown, USA

I

certify that this verification has been sent directly to the employer and has not passed through the hands of the applicant or any other interested party.

3. Signature of Lender

4. Title

5. Date

6. Lender&#39;s Number Carlos Salazar

Project Manager

12/12/2006

(Optional)

5555-5555-5555 I have applied for a mortgage loan and stated that I am now or was formerly employed by you. My signature below authorizes verification of this information. 7. Name and Address of Applicant (include employee or badge number)

8. Signature of Applicant Paulo Santos

Paulo Santos

123 Any Street, Any Town, USA Part II - Verification of Present Employment 9. Applicant&#39;s Date of Employment

10. Present Position

11. Probability of Continued Employment

06/06/2006

General Manager

3 years

12A. Current Gross Base Pay (Enter Amount and Check Period)

13. For Military Personnel Only

14. If Overtime or Bonus is Applicable, Annual

Hourly

Pay Grade

10

Is Its Continuance Likely?

Monthly

Other (Specify)

Type

Monthly Amount

Overtime

Yes

No

$ 5600

Weekly

Bonus

Yes

No

12B. Gross Earnings

Base Pay

$

520

15. If paid hourly - average hours per

week

Type

Year To Date

Past Year

Past Year

Rations

$

162

40 hours

Thru

2006

Flight or

16. Date of applicant&#39;s next pay increase Base Pay

$

15.00

$ 20.00

$

30.00

Hazard

$

756

08/08/2007

Clothing

$

452

Overtime

$

15.00

$ 20.00

$

30.00

17. Projected amount of next pay increase

Quarters

$

986

$ 5600

Commissions

$

20.00

$ 20.00

$

15.00

Pro Pay

$

123

18. Date of applicant&#39;s last pay increase

09/08/2006

Overseas or

Bonus

$

20.00

$

20.00

$

15.00

Combat

$

645

19. Amount of last pay increase

Total

$ 70.00

$ 80.00

$ 90.00

Variable Housing Allowance

$

587

$ 4800
20. Remarks (If employee was off work for any length of time, please indicate time period and reason)
Not Applicable
Part III - Verification of Previous Employment
21. Date Hired

04/04/2004

23. Salary/Wage at Termination Per (Year) (Month) (Week)

22. Date Terminated

01/03/2005

Base

$ 9500

Overtime

1250

Commissions

4500

Bonus

4000

24. Reason for Leaving

25. Position Held Medical Issue

Device Operator

Part IV - Authorized Signature - Federal statutes provide severe penalties for any fraud, intentional misrepresentation, or criminal connivance or

conspiracy purposed to influence the issuance of any guaranty or insurance by the VA Secretary, the U.S.D.A., FmHA/FHA Commissioner, or the HUD/CPD Assistant Secretary.

26. Signature of Employer

27. Title (Please print or type)

28. Date

Richard Roe

VA Secretary

01/05/2007

29. Print or type name signed in Item 26

30. Phone No.

Richard Roe

555-0100
Form 1005
July 96
</pre></div></div>
</div>
<p>As you may notice, the layout API is insufficient here. Claude agrees:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_response_from_claude</span><span class="p">(</span>
    <span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Did the applicant sign the document?</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Based on the information provided in the document:

- No, the applicant (Paulo Santos) did not sign the document. Item 8 states &#34;Signature of Applicant&#34; but there is no signature filled in. The document is a &#34;Request for Verification of Employment&#34; form that is filled out and signed by the employer, not the applicant.
</pre></div></div>
</div>
<p>Let’s instead introduce signatures as <code class="docutils literal notranslate"><span class="pre">[SIGNATURE]</span></code> token inside the resulting text.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">document</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span>
    <span class="n">file_source</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">TextractFeatures</span><span class="o">.</span><span class="n">LAYOUT</span><span class="p">,</span> <span class="n">TextractFeatures</span><span class="o">.</span><span class="n">SIGNATURES</span><span class="p">],</span>
    <span class="n">save_image</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Request for Verification of Employment
Privacy Act Notice: This information is to be used by the agency collecting it or its assignees in determining whether you qualify as a prospective mortgagor under its program. It will not be disclosed outside the agency except as required and permitted by law. You do not have to provide this information, but if you do not your application for approval as a prospec- tive mortgagor or borrower may be delayed or rejected. The information requested in this form is authorized by Title 38, USC, Chapter 37 (if VA); by 12 USC, Section 1701 et. seq. (if HUD/FHA); by 42 USC, Section 1452b (if HUD/CPD); and Title 42 USC, 1471 et. seq., or 7 USC, 1921 et. seq. (if USDA/FmHA).
Instructions: Lender - Complete items 1 through 7. Have applicant complete item 8. Forward directly to employer named in item 1. Employer - Please complete either Part II or Part III as applicable. Complete Part IV and return directly to lender named in item 2. The form is to be transmitted directly to the lender and is not to be transmitted through the applicant or any other party.
Part I - Request 1. To (Name and address of employer)

2. From (Name and address of lender)

Alejandro Rosalez

Carlos Salazar 123 Any Street, Any Town, USA

100 Main Street, Anytown, USA

I

certify that this verification has been sent directly to the employer and has not passed through the hands of the applicant or any other interested party.

3. Signature of Lender

4. Title

5. Date

6. Lender&#39;s Number

[SIGNATURE]

Carlos Salazar

Project Manager

12/12/2006

(Optional)

5555-5555-5555 I have applied for a mortgage loan and stated that I am now or was formerly employed by you. My signature below authorizes verification of this information. 7. Name and Address of Applicant (include employee or badge number)

8. Signature of Applicant Paulo Santos 123 Any Street, Any Town, USA

[SIGNATURE]

Paulo Santos Part II - Verification of Present Employment 9. Applicant&#39;s Date of Employment

10. Present Position

11. Probability of Continued Employment

06/06/2006

General Manager

3 years

12A. Current Gross Base Pay (Enter Amount and Check Period)

13. For Military Personnel Only

14. If Overtime or Bonus is Applicable, Annual

Hourly

Pay Grade

10

Is Its Continuance Likely?

Monthly

Other (Specify)

Type

Monthly Amount

Overtime

Yes

No

$ 5600

Weekly

Bonus

Yes

No

12B. Gross Earnings

Base Pay

$

520

15. If paid hourly - average hours per

week

Type

Year To Date

Past Year

Past Year

Rations

$

162

40 hours

Thru

2006

Flight or

16. Date of applicant&#39;s next pay increase Base Pay

$

15.00

$ 20.00

$

30.00

Hazard

$

756

08/08/2007

Clothing

$

452

Overtime

$

15.00

$ 20.00

$

30.00

17. Projected amount of next pay increase

Quarters

$

986

$ 5600

Commissions

$

20.00

$ 20.00

$

15.00

Pro Pay

$

123

18. Date of applicant&#39;s last pay increase

09/08/2006

Overseas or

Bonus

$

20.00

$

20.00

$

15.00

Combat

$

645

19. Amount of last pay increase

Total

$ 70.00

$ 80.00

$ 90.00

Variable Housing Allowance

$

587

$ 4800
20. Remarks (If employee was off work for any length of time, please indicate time period and reason)
Not Applicable
Part III - Verification of Previous Employment
21. Date Hired

04/04/2004

23. Salary/Wage at Termination Per (Year) (Month) (Week)

22. Date Terminated

01/03/2005

Base

$ 9500

Overtime

1250

Commissions

4500

Bonus

4000

24. Reason for Leaving

25. Position Held Medical Issue

Device Operator

Part IV - Authorized Signature - Federal statutes provide severe penalties for any fraud, intentional misrepresentation, or criminal connivance or

conspiracy purposed to influence the issuance of any guaranty or insurance by the VA Secretary, the U.S.D.A., FmHA/FHA Commissioner, or the HUD/CPD Assistant Secretary.

26. Signature of Employer

27. Title (Please print or type)

28. Date

Richard Roe

[SIGNATURE]

VA Secretary

01/05/2007

29. Print or type name signed in Item 26

30. Phone No.

Richard Roe

555-0100
Form 1005
July 96
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_response_from_claude</span><span class="p">(</span>
    <span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Did the applicant sign the document?</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Based on the information provided:

- Yes, the applicant Paulo Santos signed the document. In Part I item 7, it states &#34;Name and Address of Applicant (include employee or badge number) Paulo Santos 123 Any Street, Any Town, USA&#34; and there is a signature in item 8 for Paulo Santos.
</pre></div></div>
</div>
<p>Another piece of information that does not exist as text are selection items or checkboxes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_response_from_claude</span><span class="p">(</span>
    <span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Is the reported salary annual or hourly?</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Based on the information provided in the document:

- The reported salary in item 12A is monthly. Item 12A specifies the pay period as &#34;Monthly&#34;.

- Item 15 also indicates the applicant is paid hourly, reporting an average of 40 hours per week.

So in summary, the reported salary is monthly, but the applicant is paid on an hourly basis at an average of 40 hours per week.
</pre></div></div>
</div>
<p>All the above is wrong, the applicant is paid annually as checked in 12A but the model does not get that information. We can enrich the above text with selection item placeholders, namely <code class="docutils literal notranslate"><span class="pre">[X]</span></code> and <code class="docutils literal notranslate"><span class="pre">[]</span></code>. Note that those can be configured in the <code class="docutils literal notranslate"><span class="pre">TextLinearizationConfig</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the default configuration</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">TextLinearizationConfig</span><span class="p">(</span>
    <span class="n">selection_element_selected</span><span class="o">=</span><span class="s2">&quot;[X]&quot;</span><span class="p">,</span>
    <span class="n">selection_element_not_selected</span><span class="o">=</span><span class="s2">&quot;[]&quot;</span><span class="p">,</span>
    <span class="n">signature_token</span><span class="o">=</span><span class="s2">&quot;[SIGNATURE]&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">document</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span>
    <span class="n">file_source</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">TextractFeatures</span><span class="o">.</span><span class="n">LAYOUT</span><span class="p">,</span> <span class="n">TextractFeatures</span><span class="o">.</span><span class="n">SIGNATURES</span><span class="p">,</span> <span class="n">TextractFeatures</span><span class="o">.</span><span class="n">FORMS</span><span class="p">],</span>
    <span class="n">save_image</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Request for Verification of Employment
Privacy Act Notice: This information is to be used by the agency collecting it or its assignees in determining whether you qualify as a prospective mortgagor under its program. It will not be disclosed outside the agency except as required and permitted by law. You do not have to provide this information, but if you do not your application for approval as a prospec- tive mortgagor or borrower may be delayed or rejected. The information requested in this form is authorized by Title 38, USC, Chapter 37 (if VA); by 12 USC, Section 1701 et. seq. (if HUD/FHA); by 42 USC, Section 1452b (if HUD/CPD); and Title 42 USC, 1471 et. seq., or 7 USC, 1921 et. seq. (if USDA/FmHA).
Instructions: Lender - Complete items 1 through 7. Have applicant complete item 8. Forward directly to employer named in item 1. Employer - Please complete either Part II or Part III as applicable. Complete Part IV and return directly to lender named in item 2. The form is to be transmitted directly to the lender and is not to be transmitted through the applicant or any other party.
Part I - Request

2. From (Name and address of lender) Carlos Salazar 100 Main Street, Anytown, USA

1. To (Name and address of employer) Alejandro Rosalez 123 Any Street, Any Town, USA

I

certify that this verification has been sent directly to the employer and has not passed through the hands of the applicant or any other interested party.

5. Date 12/12/2006

6. Lender&#39;s Number (Optional) 5555-5555-5555

4. Title Project Manager

3. Signature of Lender Carlos Salazar

[SIGNATURE]

I have applied for a mortgage loan and stated that I am now or was formerly employed by you. My signature below authorizes verification of this information.

8. Signature of Applicant Paulo Santos

7. Name and Address of Applicant (include employee or badge number) Paulo Santos 123 Any Street, Any Town, USA

[SIGNATURE]

Part II - Verification of Present Employment

11. Probability of Continued Employment 3 years

10. Present Position General Manager

9. Applicant&#39;s Date of Employment 06/06/2006

13. For Military Personnel Only

12A. Current Gross Base Pay (Enter Amount and Check Period) $ 5600

14. If Overtime or Bonus is Applicable,

Pay Grade

10

Annual [X]

Hourly [ ]

Is Its Continuance Likely?

Monthly Amount

Other (Specify) [ ]

Type

Monthly [ ]

Overtime

Yes [X]

No [ ]

Yes [ ]

No [X]

Bonus

Weekly [ ]

Base Pay $ 520

15. If paid hourly - average hours per week 40 hours

12B. Gross Earnings

Year To Date

Past Year

Rations $ 162

Type

Past Year

16. Date of applicant&#39;s next pay increase 08/08/2007

Thru 2006

Flight or Hazard 756 $

Base Pay

$

15.00

$ 20.00

$

30.00

Clothing $ 452

15.00

$ 20.00

30.00

17. Projected amount of next pay increase $ 5600

Overtime

$

$

Quarters $ 986

20.00

$ 20.00

15.00

18. Date of applicant&#39;s last pay increase 09/08/2006

$

Pro Pay $ 123

Commissions

$

Overseas or Combat $ 645

20.00

20.00

15.00

19. Amount of last pay increase $ 4800

Bonus

$

$

$

Variable Housing Allowance $ 587

Total

$ 70.00

$ 80.00

$ 90.00
 20. Remarks (If employee was off work for any length of time, please indicate time period and reason) Not Applicable
Not Applicable
Part III - Verification of Previous Employment
23. Salary/Wage at Termination Per (Year) (Month) (Week)

21. Date Hired 04/04/2004

Bonus 4000

Overtime 1250

Commissions 4500

Base $ 9500

22. Date Terminated 01/03/2005

25. Position Held Device Operator

24. Reason for Leaving Medical Issue

Part IV - Authorized Signature - Federal statutes provide severe penalties for any fraud, intentional misrepresentation, or criminal connivance or

conspiracy purposed to influence the issuance of any guaranty or insurance by the VA Secretary, the U.S.D.A., FmHA/FHA Commissioner, or the HUD/CPD Assistant Secretary.

27. Title (Please print or type) VA Secretary

28. Date 01/05/2007

26. Signature of Employer Richard Roe

[SIGNATURE]

29. Print or type name signed in Item 26 Richard Roe

30. Phone No. 555-0100


Form 1005 July 96
July 96
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_response_from_claude</span><span class="p">(</span>
    <span class="n">document</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Is the reported salary annual or hourly?</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Based on the information provided in the document:

- The reported salary in Part II, item 12A is annual. It specifically states the salary of $5600 is for the &#34;Annual&#34; period.
</pre></div></div>
</div>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this heading"></a></h2>
<p>Large-language models are only as good as their input information. By leveraging Textract APIs to enrich the text representation that is provided as input you can unblock intelligent document processing workflows without implementing complex heuristics.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="layout_analysis_for_text_linearization.html" class="btn btn-neutral float-left" title="Using Layout Analysis for Text Linearization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="interfacing_with_trp2.html" class="btn btn-neutral float-right" title="Interfacing with trp2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Amazon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>